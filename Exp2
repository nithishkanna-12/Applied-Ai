import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import MinMaxScaler
from sklearn.tree import DecisionTreeClassifier
from sklearn import metrics
from sklearn.metrics import (
    confusion_matrix, ConfusionMatrixDisplay,
    accuracy_score, precision_score, recall_score, f1_score,
    roc_curve, auc, roc_auc_score
)
df = pd.read_csv("heart.csv")

print(df.head())
print(df.shape)
print(df.dtypes)
print(df.isnull().sum())

X = df.drop(columns=["output"])
y = df["output"].values

print(X.shape)
print(y.shape)

unique_values = np.unique(y)
for value in unique_values:
    print(f"Class label: {value}, Count: {np.count_nonzero(y == value)}")

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=0
)

print(X_train.shape, X_test.shape)
print(y_train.shape, y_test.shape)

scaler = MinMaxScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

dt_model = DecisionTreeClassifier(random_state=40)
dt_model.fit(X_train, y_train)

preds = dt_model.predict(X_test)

cm = confusion_matrix(y_test, preds)
print("Confusion Matrix\n", cm)

disp = ConfusionMatrixDisplay(confusion_matrix=cm)
disp.plot(cmap="Blues")
plt.title("Confusion Matrix")
plt.show()

print("Accuracy:", accuracy_score(y_test, preds) * 100)
print("Precision:", precision_score(y_test, preds) * 100)
print("Recall:", recall_score(y_test, preds) * 100)
print("F1 Score:", f1_score(y_test, preds) * 100)

roc_auc = roc_auc_score(y_test, preds)
print("ROC AUC score:", roc_auc)

fpr, tpr, _ = roc_curve(y_test, preds)
roc_auc_curve = auc(fpr, tpr)

plt.plot([0, 1], [0, 1], "k--")
plt.plot(fpr, tpr, label=f"AUC = {roc_auc_curve:.3f}")
plt.xlabel("False Positive Rate")
plt.ylabel("True Positive Rate")
plt.title("ROC Curve")
plt.legend()
plt.show()
